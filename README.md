# About Project NewsAggregator

[TASK](https://github.com/dionisiy13/laravel-task-internship/blob/main/README.md)

This project uses the following technologies:

- PHP 7.4
- Laravel Framework 8
- DB MySQL 8.0
- Bootstrap 5
- [PicoFeed](https://packagist.org/packages/nicolus/picofeed) - PHP Library to parser RSS Feeds (we use "master" version to avoid conflict with guzzlehttp 7.4)
- ext-GD - use for processing and creating images

## Backend
The backend part of the site can be divided into 2 parts:

- The first works automatically collecting and processing news.
- The second is responsible for processing requests from the web page.

### Automatically collecting and processing news.

For independent processing of new news, a task scheduler is used:
####App\Console\Kernel.php
It automatically runs every 10 min and calls the command - newsTaskScheduler
####App\Console\Commands\CreateNewsTaskScheduler
This command initializes the start of the queue by running the class
####App\HandlerNewNews\InitializeQueue\InitializeQueue.php
This class accesses the news_urls table and gets all the links for the news feeds marked as active and puts them in the queue.

Queue handler - ParserNews.php
####App\Jobs\ParserNews.php
Processes each task in turn (link for the news feeds):

1) Using class App\HandlerNewNews\Parser\Parser.php([PicoFeed](https://packagist.org/packages/nicolus/picofeed)) get an object containing the data of all news.
2) Using class App\HandlerNewNews\HandlerArticles\Reconstruction\ReconstructionBeforeLoad.php To modify all the data in the news and write them to an array.
- The reconstruction class processes each element of the news such as: title, news link, news image link, publication or change time, news site name.
- We check for the uniqueness of the news by a unique link in the database and if it already exists, then do not add it to our news data array.
- Using the handlerDate method, we process the time of publication of the news, taking into account the offset in time zones.
- Using the handlerTitle method we process the text to Convert special HTML entities back to characters.
- The handler EnclosureUrl method handles or creates a unique news image using the class App\HandlerNewNews\HandlerImg\ServiceImg.php (If the image exists, we convert it to the standard aspect ratio of 1:1.5 and crop the extra ones, the resulting image is saved locally to the server in public\image with a unique name that is generated by the method hash title news, if there is no image, create a new unique image with a standard background storage\font.png and superimposed text - the title of the news, using the font type storage\font.ttf, the text is superimposed in such a way that it is displayed correctly when creating an image, word breaks on a new line are taken into account)
3) Using clas App\HandlerNewNews\HandlerArticles\LoaderUnloaderArticles\LoaderArticles.php to download all processed news data into a table articles.


### Processing requests from the web page.
This part of the backend is responsible for the work of routing, and the processing of all incoming requests and the output of information.

####1) Login Controller has 2 methods and own error validator: login, registration, LoginRequest.
- LoginRequest error validator:
####App\Http\Requests\LoginRequest.php
This validator makes a simple check for the length of the login and password, at least 4 characters for the login and 6 characters for the password, if the check fails, an error message pops up, above a certain type of form, where the error occurred, the information in the form that was entered wrong after validation remains in the form for easy editing.

- Method registration class
####App\Http\Controllers\LoginController.php
After validation, this method will add a user to the database (his logs and a hashed password), in case of a successful operation, the user is authenticated while saving his login and password for 2 hours and redirecting to the admin panel, in case of an error (such a user already exists), it displays a window with an error message.

- Method login class
####App\Http\Controllers\LoginController.php
Due to the fact that we specified the database model in config\auth.php we after validation check for authentication use Auth::attempt, при успешной проверки ми проводим аунтификацию на 2 часа и переходим в админ панель, при возникновении ошибкы мы получаем собщения - 'Wrong login or password'

####2) AdminPanel Controller has 5 methods: showAdminPanel, changeStatusOfSource, deleteNewsUrl, logout, addNewsUrl.
App\Http\Controllers\AdminPanelController.php

- Method showAdminPanel

using class App\HandlerNewNews\ServiceAddNewsUrl\LoaderUnloaderNewsUrls\UnloaderNewsUrls to get data from a table news_urls and display them in the admin panel.

- Method changeStatusOfSource

The data received with the JavaScript on admin page when using the switch is processed and with the help class App\HandlerNewNews\ServiceAddNewsUrl\LoaderUnloaderNewsUrls\ChangeStatusNewsUrls transferred to the table to record the status.

- Method deleteNewsUrl

Is responsible for deleting a specific news feed from the database using the class App\HandlerNewNews\ServiceAddNewsUrl\LoaderUnloaderNewsUrls\DeleteNewsUrl and redirecting to the page admin panel.

- Method logout

Is responsible for terminating the authentication session and redirecting to the authorization page.

- Method addNewsUrl

Using class App\HandlerNewNews\Parser\Parser we are trying to parse the news from the received package.
When a parsing error occurs, we display messages - 'URL parsing error'.
Upon successful parsing, the data is sent to the class App\HandlerNewNews\ServiceAddNewsUrl\Reconstruction\ReconstructionForOneNews extends ReconstructionBeforeLoad for processing.
Using class App\HandlerNewNews\ServiceAddNewsUrl\LoaderUnloaderNewsUrls\LoaderNewsUrls we update a table in the database or add a new value and redirecting to the page admin panel.

####3) ArticleController Controller has only one method: showArticles

This method using the class App\HandlerNewNews\HandlerArticles\LoaderUnloaderArticles\UnloaderArticles, loads all the necessary data about the news from the database, sorted by publication time and pagination usage.
Next, we display news information in articles using pagination and infinite scrolling.

## Frontend

When developing the frontend, I used: HTML CSS Bootstrap and javascript jquery. HTML, CSS, javascript and images files are stored in public\css, public\js, views\public\image folder. The front-end part is made taking into account screen scaling.
Data entry forms are implemented using Cross Site Request Forgery (CSRF) protection.
Implemented the function of infinite scrolling and processing switches without reloading the page using javascript jquery.

